{
  "hash": "540e86d3b61f6b5aca7605d21bce734f",
  "result": {
    "engine": "knitr",
    "markdown": "---\nformat: live-html\ntitle: The Power of Patchwork\nwebr:\n  engine: knitr\n  packages:\n    - dplyr\n    - ggplot2\n    - medicaldata\n    - gt\n    - patchwork\n---\n\n\n\n\n\nWe will combine a table and a plot into a single graphic, using the {patchwork} \npackage.\nLet's start by loading in some data from {medicaldata}\n\n\n\n\n\n::: {.cell setup='true' exercise='ex_3'}\n\n```{.r .cell-code}\nlibrary(dplyr)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dplyr'\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:stats':\n\n    filter, lag\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nThe following objects are masked from 'package:base':\n\n    intersect, setdiff, setequal, union\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(medicaldata)\nlibrary(gt)\n```\n:::\n\n\n\n\nWe will  now create a summary table in gt\nthat compares radiographic outcomes by arm\nfrom 1 = Death to 6 = Considerable improvement.\n3 = Moderate deterioration and 4 = No change\n\nThis HTML table would show up in RStudio in the Viewer tab.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd <- medicaldata::strep_tb \nd |> select(arm, rad_num) |> \n  group_by(arm) |> \n  summarize(rad6m = mean(rad_num),\n            sd = sd(rad_num)) |> \n  gt::gt() ->t1\nt1\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"grsjfszwcc\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#grsjfszwcc table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#grsjfszwcc thead, #grsjfszwcc tbody, #grsjfszwcc tfoot, #grsjfszwcc tr, #grsjfszwcc td, #grsjfszwcc th {\n  border-style: none;\n}\n\n#grsjfszwcc p {\n  margin: 0;\n  padding: 0;\n}\n\n#grsjfszwcc .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#grsjfszwcc .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#grsjfszwcc .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#grsjfszwcc .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#grsjfszwcc .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#grsjfszwcc .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#grsjfszwcc .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#grsjfszwcc .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#grsjfszwcc .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#grsjfszwcc .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#grsjfszwcc .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#grsjfszwcc .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#grsjfszwcc .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#grsjfszwcc .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#grsjfszwcc .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#grsjfszwcc .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#grsjfszwcc .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#grsjfszwcc .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#grsjfszwcc .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#grsjfszwcc .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#grsjfszwcc .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#grsjfszwcc .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#grsjfszwcc .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#grsjfszwcc .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#grsjfszwcc .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#grsjfszwcc .gt_left {\n  text-align: left;\n}\n\n#grsjfszwcc .gt_center {\n  text-align: center;\n}\n\n#grsjfszwcc .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#grsjfszwcc .gt_font_normal {\n  font-weight: normal;\n}\n\n#grsjfszwcc .gt_font_bold {\n  font-weight: bold;\n}\n\n#grsjfszwcc .gt_font_italic {\n  font-style: italic;\n}\n\n#grsjfszwcc .gt_super {\n  font-size: 65%;\n}\n\n#grsjfszwcc .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#grsjfszwcc .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#grsjfszwcc .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#grsjfszwcc .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#grsjfszwcc .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#grsjfszwcc .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#grsjfszwcc .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#grsjfszwcc .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#grsjfszwcc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"arm\">arm</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"rad6m\">rad6m</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sd\">sd</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"arm\" class=\"gt_row gt_left\">Control</td>\n<td headers=\"rad6m\" class=\"gt_row gt_right\">3.134615</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">1.726709</td></tr>\n    <tr><td headers=\"arm\" class=\"gt_row gt_left\">Streptomycin</td>\n<td headers=\"rad6m\" class=\"gt_row gt_right\">4.672727</td>\n<td headers=\"sd\" class=\"gt_row gt_right\">1.732634</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\n\n\nNow let's convert this table into a gtable object\ncomposed of 11 grobs (graphical objects), which you can see in the Console.\nNotice that you now have to plot it to make it show up,\namd in RStudio it would show up (by default) centered in the Plots tab.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gtable)\ngt1 <- t1 |> as_gtable()\ngt1\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTableGrob (3 x 5) \"layout\": 11 grobs\n    z     cells           name\n1   1 (1-1,2-2) column_label_1\n2   2 (1-1,3-3) column_label_2\n3   3 (1-1,4-4) column_label_3\n4   4 (2-2,2-2)    body_cell_1\n5   5 (2-2,3-3)    body_cell_2\n6   6 (2-2,4-4)    body_cell_3\n7   7 (3-3,2-2)    body_cell_4\n8   8 (3-3,3-3)    body_cell_5\n9   9 (3-3,4-4)    body_cell_6\n10 10 (2-3,2-4)     table_body\n11 11 (1-3,2-4)          table\n                                 grob\n1   gt_grid_cell[GRID.gt_grid_cell.3]\n2   gt_grid_cell[GRID.gt_grid_cell.6]\n3   gt_grid_cell[GRID.gt_grid_cell.9]\n4  gt_grid_cell[GRID.gt_grid_cell.13]\n5  gt_grid_cell[GRID.gt_grid_cell.17]\n6  gt_grid_cell[GRID.gt_grid_cell.21]\n7  gt_grid_cell[GRID.gt_grid_cell.25]\n8  gt_grid_cell[GRID.gt_grid_cell.29]\n9  gt_grid_cell[GRID.gt_grid_cell.33]\n10 gt_grid_cell[GRID.gt_grid_cell.36]\n11 gt_grid_cell[GRID.gt_grid_cell.39]\n```\n\n\n:::\n\n```{.r .cell-code}\nplot(gt1)\n```\n\n::: {.cell-output-display}\n![](inset_table_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\n\n\nNow we will make our plot,\nwhich will show up in RStudio in the Plots tab.\nRun the code below to get the plot.\nWe use `expand_limits` in ggplot to make extra room for the table.\nThe Streptomycin column is 1, and the Control column is 2.\nWe are expanding to add empty columns 3 and 4.\nRun the code with the blue `Run Code` button, then \nTurn off `expand_limits` with a hashtag to comment it out to see how this works,\nthen Run the code again.\nDo you know what would happen if we used `geom_point`?\nTry it out in the code chunk below. Re-run the code.\nClick on the `Start Over` button to restore the code to its original state.\n\n```{webr-r}\n#| exercise: ex_1\nlibrary(patchwork)\nlibrary(ggplot2)\nd <- medicaldata::strep_tb \n\nd |> \n  ggplot(aes(x= arm, y = rad_num, color= baseline_cavitation)) +\n  geom_jitter(size = 3) +\n  labs(y = \"Radiologic Score\", x = \"Study Arm\",\n       title = \"Radiologic Outcomes for TB by Treatment Arm\",\n       subtitle = \"colored by baseline cavitation, 4 = No Change\") +\n  expand_limits(x = c(1,4)) +\n  theme_linedraw(base_size = 16) +\n  scale_color_manual(values = c(\"green\", \"black\")) +\n  theme(legend.position = \"top\") ->\n  p1\np1\n```\n\nNow insert the `gt1` graphical object table into the plot with the {patchwork} function, `inset_element`, using the code below at line 25 and beyond.\nThe first 23 lines rebuild the table and plot objects.\nRun the code.\nThe standard ggplot has the point 0,0 at bottom left, \nand the point 1,1 at the top right.\nIn the last part of the code chunk below, experiment with the location of the plot by\nchanging the TRBL (pronounced 'trouble') parameters, then rerun the code.\nAlso experiment with the alignment - options include 'full' and 'plot',\nand run the code, to\nsee if you can figure out what the table is being aligned with for each option.\n\n```{webr-r}\n#| exercise: ex_2\n\nd <- medicaldata::strep_tb \n\nd |> select(arm, rad_num) |> \n  group_by(arm) |> \n  summarize(rad6m = mean(rad_num),\n            sd = sd(rad_num)) |> \n  gt::gt() |> \n  as_gtable() ->\ngt1\n\nd |> \n  ggplot(aes(x= arm, y = rad_num, color= baseline_cavitation)) +\n  geom_jitter(size = 3) +\n  labs(y = \"Radiologic Score\", x = \"Study Arm\",\n       title = \"Radiologic Outcomes for TB by Treatment Arm\",\n       subtitle = \"colored by baseline cavitation, 4 = No Change\") +\n  expand_limits(x = c(1,4)) +\n  theme_linedraw(base_size = 16) +\n  scale_color_manual(values = c(\"green\", \"black\")) +\n  theme(legend.position = \"top\") ->\n  p1\n\n\np1 +\n  inset_element(gt1, top= 0.6, right=0.9, bottom =0.4,left = 0.65, \n                align_to = 'panel')\n```\n\n\n",
    "supporting": [
      "inset_table_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}